!function(e){function t(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function n(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};r.format=function(e,i){var o,a,s,c,l,u,h,f=1,p=e.length,d="",m=[];for(a=0;p>a;a++)if(d=t(e[a]),"string"===d)m.push(e[a]);else if("array"===d){if(c=e[a],c[2])for(o=i[f],s=0;s<c[2].length;s++){if(!o.hasOwnProperty(c[2][s]))throw r('[sprintf] property "%s" does not exist',c[2][s]);o=o[c[2][s]]}else o=c[1]?i[c[1]]:i[f++];if(/[^s]/.test(c[8])&&"number"!=t(o))throw r("[sprintf] expecting number but found %s",t(o));switch(c[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=c[7]?o.toExponential(c[7]):o.toExponential();break;case"f":o=c[7]?parseFloat(o).toFixed(c[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&c[7]?o.substring(0,c[7]):o;break;case"u":o>>>=0;break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(c[8])&&c[3]&&o>=0?"+"+o:o,u=c[4]?"0"==c[4]?"0":c[4].charAt(1):" ",h=c[6]-String(o).length,l=c[6]?n(u,h):"",m.push(c[5]?o+l:l+o)}return m.join("")},r.cache={},r.parse=function(e){for(var t=e,n=[],r=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){i|=1;var o=[],a=n[2],s=[];if(null===(s=/^([a-z_][a-z_\d]*)/i.exec(a)))throw"[sprintf] huh?";for(o.push(s[1]);""!==(a=a.substring(s[0].length));)if(null!==(s=/^\.([a-z_][a-z_\d]*)/i.exec(a)))o.push(s[1]);else{if(null===(s=/^\[(\d+)\]/.exec(a)))throw"[sprintf] huh?";o.push(s[1])}n[2]=o}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r};var i=function(e,t,n){return n=t.slice(0),n.splice(0,0,e),r.apply(null,n)};e.sprintf=r,e.vsprintf=i}("undefined"!=typeof exports?exports:window),function(e,t){"use strict";function n(e,t){var n;if("string"==typeof e&&"string"==typeof t)return localStorage[e]=t,!0;if("object"==typeof e&&"undefined"==typeof t){for(n in e)e.hasOwnProperty(n)&&(localStorage[n]=e[n]);return!0}return!1}function r(e,t){var n,r,i;if(n=new Date,n.setTime(n.getTime()+31536e6),r="; expires="+n.toGMTString(),"string"==typeof e&&"string"==typeof t)return document.cookie=e+"="+t+r+"; path=/",!0;if("object"==typeof e&&"undefined"==typeof t){for(i in e)e.hasOwnProperty(i)&&(document.cookie=i+"="+e[i]+r+"; path=/");return!0}return!1}function i(e){return localStorage[e]}function o(e){var t,n,r,i;for(t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null}function a(e){return delete localStorage[e]}function s(e){return r(e,"",-1)}function c(e,t){var n=[],r=e.length;if(t>r)return[e];if(0>t)throw new Error("str_parts: length can't be negative");for(var i=0;r>i;i+=t)n.push(e.substring(i,i+t));return n}function l(t){var n=t?[t]:[],r=0;e.extend(this,{get:function(){return n},rotate:function(){return 1===n.length?n[0]:(r===n.length-1?r=0:++r,n[r])},length:function(){return n.length},remove:function(e){n.splice(e,1)},set:function(e){for(var t=n.length;t--;)if(n[t]===e)return void(r=t);this.append(e)},front:function(){return n[r]},append:function(e){n.push(e)}})}function u(t){var n=t instanceof Array?t:t?[t]:[];e.extend(this,{map:function(t){return e.map(n,t)},size:function(){return n.length},pop:function(){if(0===n.length)return null;var e=n[n.length-1];return n=n.slice(0,n.length-1),e},push:function(e){return n=n.concat([e]),e},top:function(){return n.length>0?n[n.length-1]:null},clone:function(){return new u(n.slice(0))}})}function h(t,n){var r=!0,i="";"string"==typeof t&&""!==t&&(i=t+"_"),i+="commands";var o=e.Storage.get(i);o=o?e.parseJSON(o):[];var a=o.length-1;e.extend(this,{append:function(t){r&&o[o.length-1]!==t&&(o.push(t),n&&o.length>n&&(o=o.slice(-n)),a=o.length-1,e.Storage.set(i,e.json_stringify(o)))},data:function(){return o},reset:function(){a=o.length-1},last:function(){return o[length-1]},end:function(){return a===o.length-1},position:function(){return a},current:function(){return o[a]},next:function(){return a<o.length-1&&++a,-1!==a?o[a]:void 0},previous:function(){var e=a;return a>0&&--a,-1!==e?o[a]:void 0},clear:function(){o=[],this.purge()},enabled:function(){return r},enable:function(){r=!0},purge:function(){e.Storage.remove(i)},disable:function(){r=!1}})}function f(){var e=!1,n="animation",r="",i="Webkit Moz O ms Khtml".split(" "),o="",a=document.createElement("div");if(a.style.animationName&&(e=!0),e===!1)for(var s=0;s<i.length;s++){var c=i[s]+"AnimationName";if(a.style[c]!==t){o=i[s],n=o+"Animation",r="-"+o.toLowerCase()+"-",e=!0;break}}return e}function p(){return-1!=navigator.userAgent.toLowerCase().indexOf("android")}function d(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}function m(t,n){var r=n(t);if(r.length){var i=r.shift(),o=new RegExp("^"+e.terminal.escape_regex(i)),a=t.replace(o,"").trim();return{command:t,name:i,args:r,rest:a}}return{command:t,name:"",args:[],rest:""}}function g(t){var n=e(window).scrollTop(),r=n+e(window).height(),i=e(t).offset().top,o=i+e(t).height();return o>=n&&r>=i}function v(){var t=e('<div class="terminal temp"><div class="cmd"><span class="cursor">&nbsp;</span></div></div>').appendTo("body"),n=t.find("span"),r={width:n.width(),height:n.outerHeight()};return t.remove(),r}function y(t){for(var n=e('<div class="terminal wrap"><span class="cursor"></span></div>').appendTo("body").css("padding",0),r=n.find("span"),i=60,o="",a=0;i>=a;++a)o+="&nbsp;";r.html(o);var s=r.width()/i,c=Math.floor(t.width()/s);if(n.remove(),b(t)){var l=20,u=t.innerWidth()-t.width();c-=Math.ceil((l-u/2)/(s-1))}return c}function w(e){return Math.floor(e.height()/v().height)}function _(){if(window.getSelection||document.getSelection){var e=(window.getSelection||document.getSelection)();return e.text?e.text:e.toString()}return document.selection?document.selection.createRange().text:void 0}function b(t){return t.is("body")?e("body").height()>e(window).height():t.get(0).scrollHeight>t.innerHeight()}e.omap=function(t,n){var r={};return e.each(t,function(e,i){r[e]=n.call(t,e,i)}),r};var x={clone_object:function(t){var n={};if("object"==typeof t){if(e.isArray(t))return this.clone_array(t);if(null===t)return t;for(var r in t)e.isArray(t[r])?n[r]=this.clone_array(t[r]):"object"==typeof t[r]?n[r]=this.clone_object(t[r]):n[r]=t[r]}return n},clone_array:function(t){if(!e.isFunction(Array.prototype.map))throw new Error("You'r browser don't support ES5 array map use es5-shim");return t.slice(0).map(function(e){return"object"==typeof e?this.clone_object(e):e}.bind(this))}},k=function(e){return x.clone_object(e)},$="undefined"!=typeof window.localStorage;e.extend({Storage:{set:$?n:r,get:$?i:o,remove:$?a:s}}),jQuery.fn.extend({everyTime:function(e,t,n,r,i){return this.each(function(){jQuery.timer.add(this,e,t,n,r,i)})},oneTime:function(e,t,n){return this.each(function(){jQuery.timer.add(this,e,t,n,1)})},stopTime:function(e,t){return this.each(function(){jQuery.timer.remove(this,e,t)})}}),jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1e3,das:1e4,hs:1e5,ks:1e6},timeParse:function(e){if(e===t||null===e)return null;var n=this.regex.exec(jQuery.trim(e.toString()));if(n[2]){var r=parseInt(n[1],10),i=this.powers[n[2]]||1;return r*i}return e},add:function(e,t,n,r,i,o){var a=0;if(jQuery.isFunction(n)&&(i||(i=r),r=n,n=t),t=jQuery.timer.timeParse(t),!("number"!=typeof t||isNaN(t)||0>=t)){i&&i.constructor!==Number&&(o=!!i,i=0),i=i||0,o=o||!1,e.$timers||(e.$timers={}),e.$timers[n]||(e.$timers[n]={}),r.$timerID=r.$timerID||this.guid++;var s=function(){o&&s.inProgress||(s.inProgress=!0,(++a>i&&0!==i||r.call(e,a)===!1)&&jQuery.timer.remove(e,n,r),s.inProgress=!1)};s.$timerID=r.$timerID,e.$timers[n][r.$timerID]||(e.$timers[n][r.$timerID]=window.setInterval(s,t)),this.global[n]||(this.global[n]=[]),this.global[n].push(e)}},remove:function(e,t,n){var r,i=e.$timers;if(i){if(t){if(i[t]){if(n)n.$timerID&&(window.clearInterval(i[t][n.$timerID]),delete i[t][n.$timerID]);else for(var o in i[t])i[t].hasOwnProperty(o)&&(window.clearInterval(i[t][o]),delete i[t][o]);for(r in i[t])if(i[t].hasOwnProperty(r))break;r||(r=null,delete i[t])}}else for(var a in i)i.hasOwnProperty(a)&&this.remove(e,a,n);for(r in i)if(i.hasOwnProperty(r))break;r||(e.$timers=null)}}}}),/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&jQuery(window).one("unload",function(){var e=jQuery.timer.global;for(var t in e)if(e.hasOwnProperty(t))for(var n=e[t],r=n.length;--r;)jQuery.timer.remove(n[r],t)}),function(e){if(String.prototype.split.toString().match(/\[native/)){var t,n=String.prototype.split,r=/()??/.exec("")[1]===e;return t=function(t,i,o){if("[object RegExp]"!==Object.prototype.toString.call(i))return n.call(t,i,o);var a,s,c,l,u=[],h=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),f=0;for(i=new RegExp(i.source,h+"g"),t+="",r||(a=new RegExp("^"+i.source+"$(?!\\s)",h)),o=o===e?-1>>>0:o>>>0;(s=i.exec(t))&&(c=s.index+s[0].length,!(c>f&&(u.push(t.slice(f,s.index)),!r&&s.length>1&&s[0].replace(a,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(s[t]=e)}),s.length>1&&s.index<t.length&&Array.prototype.push.apply(u,s.slice(1)),l=s[0].length,f=c,u.length>=o)));)i.lastIndex===s.index&&i.lastIndex++;return f===t.length?(l||!i.test(""))&&u.push(""):u.push(t.slice(f)),u.length>o?u.slice(0,o):u},String.prototype.split=function(e,n){return t(this,e,n)},t}}(),e.fn.caret=function(e){var t=this[0],n="true"===t.contentEditable;if(0==arguments.length){if(window.getSelection){if(n){t.focus();var r=window.getSelection().getRangeAt(0),i=r.cloneRange();return i.selectNodeContents(t),i.setEnd(r.endContainer,r.endOffset),i.toString().length}return t.selectionStart}if(document.selection){if(t.focus(),n){var r=document.selection.createRange(),i=document.body.createTextRange();return i.moveToElementText(t),i.setEndPoint("EndToEnd",r),i.text.length}var e=0,o=t.createTextRange(),i=document.selection.createRange().duplicate(),a=i.getBookmark();for(o.moveToBookmark(a);0!==o.moveStart("character",-1);)e++;return e}return 0}if(-1==e&&(e=this[n?"text":"val"]().length),window.getSelection)n?(t.focus(),window.getSelection().collapse(t.firstChild,e)):t.setSelectionRange(e,e);else if(document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(t),o.moveStart("character",e),o.collapse(!0),o.select()}return n||t.focus(),e},e.json_stringify=function(n,r){var i,o="";r=r===t?1:r;var a=typeof n;switch(a){case"function":o+=n;break;case"boolean":o+=n?"true":"false";break;case"object":if(null===n)o+="null";else if(n instanceof Array){o+="[";var s=n.length;for(i=0;s-1>i;++i)o+=e.json_stringify(n[i],r+1);o+=e.json_stringify(n[s-1],r+1)+"]"}else{o+="{";for(var c in n)n.hasOwnProperty(c)&&(o+='"'+c+'":'+e.json_stringify(n[c],r+1));o+="}"}break;case"string":var l=n,u={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(i in u)u.hasOwnProperty(i)&&(l=l.replace(new RegExp(i,"g"),u[i]));o+='"'+l+'"';break;case"number":o+=String(n)}return o+=r>1?",":"",1===r&&(o=o.replace(/,([\]}])/g,"$1")),o.replace(/([\[{]),/g,"$1")};var T=function(){var e=document.createElement("div");return e.setAttribute("onpaste","return;"),"function"==typeof e.onpaste}();e.fn.cmd=function(n){function r(){if(P){var e=x.is(":focus");e||x.focus()}else focus&&x.blur()}function i(){d()&&w.oneTime(10,function(){x.val(D),w.oneTime(10,function(){x.caret(K)})})}function o(e){Y.toggleClass("inverted")}function a(){F="(reverse-i-search)`"+M+"': ",X()}function s(){F=C,L=!1,z=null,M=""}function l(e){var t,n,r=A.data(),i=r.length;if(e&&z>0&&(i-=z),M.length>0)for(var o=M.length;o>0;o--){n=M.substring(0,o).replace(/([.*+{}\[\]?])/g,"\\$1"),t=new RegExp(n);for(var s=i;s--;)if(t.test(r[s]))return z=r.length-s,w.position(0),w.set(r[s],!0),B(),void(M.length!==o&&(M=M.substring(0,o),a()))}M=""}function u(){var e=w.width(),t=Y.width();k=Math.floor(e/t)}function m(e){var t=e.substring(0,k-$),n=e.substring(k-$);return[t].concat(c(n,k))}function g(){e(".cmd").each(function(){var t=e(this),n=t.data("cmd");if(n.isenabled()){var r=t.find("textarea");r.is(":focus")||r.focus(),n.oneTime(100,function(){n.insert(r.val()),r.val(""),i()})}})}function v(r){var i,o,c;if(P){if(e.isFunction(n.keydown)&&(i=n.keydown(r),i!==t))return i;if(38===r.which||80===r.which&&r.ctrlKey||(Q=!0),!L||35!==r.which&&36!==r.which&&37!==r.which&&38!==r.which&&39!==r.which&&40!==r.which&&13!==r.which&&27!==r.which){if(r.altKey)return 68===r.which?(w.set(D.slice(0,K)+D.slice(K).replace(/ *[^ ]+ *(?= )|[^ ]+$/,""),!0),!1):!0;if(13===r.keyCode)if(r.shiftKey)w.insert("\n");else{(A&&D&&!R&&e.isFunction(n.historyFilter)&&n.historyFilter(D)||n.historyFilter instanceof RegExp&&D.match(n.historyFilter)||!n.historyFilter)&&A.append(D);var u=D;A.reset(),w.set(""),n.commands&&n.commands(u),e.isFunction(F)&&X()}else if(8===r.which){if(L?(M=M.slice(0,-1),a()):""!==D&&K>0&&w["delete"](-1),d())return!0}else if(67===r.which&&r.ctrlKey&&r.shiftKey)N=_();else if(86===r.which&&r.ctrlKey&&r.shiftKey)""!==N&&w.insert(N);else if(9!==r.which||r.ctrlKey||r.altKey){if(46===r.which)return void w["delete"](1);if(A&&38===r.which&&!r.ctrlKey||80===r.which&&r.ctrlKey)Q?(S=D,w.set(A.current())):w.set(A.previous()),Q=!1;else if(A&&40===r.which&&!r.ctrlKey||78===r.which&&r.ctrlKey)w.set(A.end()?S:A.next());else if(37===r.which||66===r.which&&r.ctrlKey)if(r.ctrlKey&&66!==r.which){c=K-1,o=0," "===D[c]&&--c;for(var h=c;h>0;--h){if(" "===D[h]&&" "!==D[h+1]){o=h+1;break}if("\n"===D[h]&&"\n"!==D[h+1]){o=h;break}}w.position(o)}else K>0&&(w.position(-1,!0),B());else if(82===r.which&&r.ctrlKey)L?l(!0):(C=F,a(),S=D,w.set(""),B(),L=!0);else if(71==r.which&&r.ctrlKey)L&&(F=C,X(),w.set(S),B(),L=!1,M="");else if(39===r.which||70===r.which&&r.ctrlKey)if(r.ctrlKey&&70!==r.which){" "===D[K]&&++K;var f=/\S[\n\s]{2,}|[\n\s]+\S?/,p=D.slice(K).match(f);!p||p[0].match(/^\s+$/)?w.position(D.length):" "!==p[0][0]?K+=p.index+1:(K+=p.index+p[0].length-1," "!==p[0][p[0].length-1]&&--K),B()}else K<D.length&&w.position(1,!0);else{if(123===r.which)return;if(36===r.which)w.position(0);else if(35===r.which)w.position(D.length);else{if(r.shiftKey&&45==r.which)return x.val(""),void(T||g());if(!r.ctrlKey&&!r.metaKey)return U=!1,void(H=!0);if(192===r.which)return;if(r.metaKey){if(82===r.which)return;if(76===r.which)return}if(r.shiftKey){if(84===r.which)return}else{if(81===r.which){if(""!==D&&0!==K){var m=D.slice(0,K).match(/([^ ]+ *$)/);O=w["delete"](-m[0].length)}return!1}if(72===r.which)return""!==D&&K>0&&w["delete"](-1),!1;if(65===r.which)w.position(0);else if(69===r.which)w.position(D.length);else{if(88===r.which||67===r.which||84===r.which)return;if(89===r.which)""!==O&&w.insert(O);else{if(86===r.which)return x.val(""),void(T||g());if(75===r.which)O=w["delete"](D.length-K);else if(85===r.which)""!==D&&0!==K&&(O=w["delete"](-K));else if(17===r.which)return!1}}}}}}else w.insert("	")}else s(),X(),27===r.which&&w.set(""),B(),v.call(this,r);return U=!0,!1}}function y(){e.isFunction(n.onCommandChange)&&n.onCommandChange(D)}var w=this,b=w.data("cmd");if(b)return b;w.addClass("cmd"),w.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var x=e("<textarea />").addClass("clipboard").appendTo(w);n.width&&w.width(n.width);var k,$,C,S,F,P,I,A,j,E=w.find(".prompt"),L=!1,M="",z=null,R=n.mask||!1,D="",N="",O="",K=0,W=n.historySize||60,Y=w.find(".cursor");if(f()&&!p())j=function(e){e?Y.addClass("blink"):Y.removeClass("blink")};else{var q=!1;j=function(e){e&&!q?(q=!0,Y.addClass("inverted"),w.everyTime(500,"blink",o)):q&&!e&&(q=!1,w.stopTime("blink",o),Y.removeClass("inverted"))}}var H,B=function(t){function n(t,n){var r=t.length;if(n===r)a.html(e.terminal.encode(t)),Y.html("&nbsp;"),s.html("");else if(0===n)a.html(""),Y.html(e.terminal.encode(t.slice(0,1))),s.html(e.terminal.encode(t.slice(1)));else{var i=t.slice(0,n);a.html(e.terminal.encode(i));var o=t.slice(n,n+1);Y.html(e.terminal.encode(o)),s.html(n===t.length-1?"":e.terminal.encode(t.slice(n+1)))}}function r(t){return"<div>"+e.terminal.encode(t)+"</div>"}function i(t){var n=s;e.each(t,function(t,i){n=e(r(i)).insertAfter(n).addClass("clear")})}function o(t){e.each(t,function(e,t){a.before(r(t))})}var a=Y.prev(),s=Y.next();return function(){var l,u;switch(typeof R){case"boolean":l=R?D.replace(/./g,"*"):D;break;case"string":l=D.replace(/./g,R)}var h,f;if(t.find("div").remove(),a.html(""),l.length>k-$-1||l.match(/\n/)){var p,d=l.match(/\t/g),g=d?3*d.length:0;if(d&&(l=l.replace(/\t/g,"\x00\x00\x00\x00")),l.match(/\n/)){var v=l.split("\n");for(f=k-$-1,h=0;h<v.length-1;++h)v[h]+=" ";for(v[0].length>f?(p=[v[0].substring(0,f)],u=v[0].substring(f),p=p.concat(c(u,k))):p=[v[0]],h=1;h<v.length;++h)v[h].length>k?p=p.concat(c(v[h],k)):p.push(v[h])}else p=m(l);if(d&&(p=e.map(p,function(e){return e.replace(/\x00\x00\x00\x00/g,"	")})),f=p[0].length,0===f&&1===p.length);else if(f>K)n(p[0],K),i(p.slice(1));else if(K===f)a.before(r(p[0])),n(p[1],0),i(p.slice(2));else{var y=p.length;if(f>K)n(p[0],K),i(p.slice(1));else if(K===f)a.before(r(p[0])),n(p[1],0),i(p.slice(2));else{var w=p.slice(-1)[0],_=l.length-K-g,b=w.length,x=0;if(b>=_)o(p.slice(0,-1)),x=b===_?0:b-_,n(w,x);else if(3===y)u=e.terminal.encode(p[0]),a.before("<div>"+u+"</div>"),n(p[1],K-f-1),u=e.terminal.encode(p[2]),s.after('<div class="clear">'+u+"</div>");else{var T,C;for(x=K,h=0;h<p.length;++h){var S=p[h].length;if(!(x>S))break;x-=S}C=p[h],T=h,x===C.length&&(x=0,C=p[++T]),n(C,x),o(p.slice(0,T)),i(p.slice(T+1))}}}}else""===l?(a.html(""),Y.html("&nbsp;"),s.html("")):n(l,K)}}(w),X=function(){function t(t){E.html(e.terminal.format(e.terminal.encode(t))),$=E.text().length}return function(){switch(typeof F){case"string":t(F);break;case"function":F(t)}}}(),Q=!0,U=!1;e.extend(w,{name:function(e){if(e!==t){I=e;var n=A&&A.enabled()||!A;return A=new h(e,W),n||A.disable(),w}return I},purge:function(){return A.clear(),w},history:function(){return A},"delete":function(e,t){var n;return 0===e?w:(0>e?K>0&&(n=D.slice(0,K).slice(e),D=D.slice(0,K+e)+D.slice(K,D.length),t?y():w.position(K+e)):""!==D&&K<D.length&&(n=D.slice(K).slice(0,e),D=D.slice(0,K)+D.slice(K+e,D.length),y()),B(),i(),n)},set:function(e,n){return e!==t&&(D=e,n||w.position(D.length),B(),i(),y()),w},insert:function(e,t){return K===D.length?D+=e:D=0===K?e+D:D.slice(0,K)+e+D.slice(K),t?i():w.position(e.length,!0),B(),y(),w},get:function(){return D},commands:function(e){return e?(n.commands=e,w):e},destroy:function(){return e(document.documentElement||window).unbind(".cmd"),w.stopTime("blink",o),w.find(".cursor").next().remove().end().prev().remove().end().remove(),w.find(".prompt, .clipboard").remove(),w.removeClass("cmd").removeData("cmd"),w},prompt:function(e){if(e===t)return F;if("string"!=typeof e&&"function"!=typeof e)throw"prompt must be a function or string";return F=e,X(),B(),w},kill_text:function(){return O},position:function(t,r){return"number"==typeof t?(r?K+=t:K=0>t?0:t>D.length?D.length:t,e.isFunction(n.onPositionChange)&&n.onPositionChange(K),B(),i(),w):K},visible:function(){var e=w.visible;return function(){e.apply(w,[]),B(),X()}}(),show:function(){var e=w.show;return function(){e.apply(w,[]),B(),X()}}(),resize:function(e){return e?k=e:u(),B(),w},enable:function(){return P=!0,w.addClass("enabled"),j(!0),r(),w},isenabled:function(){return P},disable:function(){return P=!1,w.removeClass("enabled"),j(!1),r(),w},mask:function(e){return"undefined"==typeof e?R:(R=e,B(),w)}}),w.name(n.name||n.prompt||""),F="string"==typeof n.prompt?n.prompt:"> ",X(),(n.enabled===t||n.enabled===!0)&&w.enable();var G=e(document.documentElement||window);return G.bind("keypress.cmd",function(r){var i;if(H=!1,!(r.ctrlKey&&99===r.which||U)){if(!L&&e.isFunction(n.keypress)&&(i=n.keypress(r)),i!==t&&!i)return i;if(P){if(e.inArray(r.which,[38,13,0,8])>-1&&(38!==r.which||!r.shiftKey)){if(123==r.keyCode)return;return!1}if(!r.ctrlKey&&(!r.altKey||100!==r.which)||r.altKey)return L?(M+=String.fromCharCode(r.which),l(),a()):w.insert(String.fromCharCode(r.which)),!1}}}).bind("keydown.cmd",v).bind("keyup.cmd",function(e){if(H){var t=x.val();(t||8==e.which)&&w.set(t)}}),T&&G.bind("paste.cmd",g),w.data("cmd",w),w};var C=/(\[\[[!gbiuso]*;[^;]*;[^\]]*\](?:[^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?)/i,S=/\[\[([!gbiuso]*);([^;]*);([^;\]]*);?([^;\]]*);?([^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,F=/\[\[([!gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,P=/^\[\[([!gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]$/gi,I=/^#([0-9a-f]{3}|[0-9a-f]{6})$/i,A=/(\bhttps?:\/\/(?:(?:(?!&[^;]+;)|(?=&amp;))[^\s"'<>\]\[)])+\b)/gi,j=/((([^<>('")[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,})))/g,E=/('[^']*'|"(\\"|[^"])*"|(?:\/(\\\/|[^\/])+\/[gimy]*)(?=:? |$)|(\\ |[^ ])+|[\w-]+)/gi,L=/(\[\[[!gbiuso]*;[^;]*;[^\]]*\])/i,M=/\[\[[!gbiuso]*;[^;]*;[^\]]*\]?$/i,z=/(\[\[(?:[^\]]|\](?!\]))*\]\])/;e.terminal={version:"0.9.3",color_names:["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],valid_color:function(t){return t.match(I)?!0:-1!==e.inArray(t.toLowerCase(),e.terminal.color_names)},escape_regex:function(e){if("string"==typeof e){var t=/([-\\\^$\[\]()+{}?*.|])/g;return e.replace(t,"\\$1")}},have_formatting:function(e){return"string"==typeof e&&!!e.match(F)},is_formatting:function(e){return"string"==typeof e&&!!e.match(P)},format_split:function(e){return e.split(C)},split_equal:function(e,t,n){for(var r=!1,i=!1,o="",a=[],s=e.replace(F,function(e,t,n){var r=t.match(/;/g).length;return r=2==r?";;":3==r?";":"","[["+t+r+n.replace(/\\\]/g,"&#93;").replace(/\n/g,"\\n")+"]"+n+"]"}).split(/\n/g),c=0,l=s.length;l>c;++c)if(""!==s[c])for(var u=s[c],h=0,f=0,p=0,d=u.length;d>p;++p){if("["===u[p]&&"["===u[p+1])r=!0;else if(r&&"]"===u[p])i?(r=!1,i=!1):i=!0;else if(r&&i||!r){if("&"===u[p]){var m=u.substring(p).match(/^(&[^;]+;)/);if(!m)throw new Error("Unclosed html entity in line "+(c+1)+" at char "+(p+1));p+=m[1].length-2,p===d-1&&a.push(g+m[1]);continue}"]"===u[p]&&"\\"===u[p-1]?--f:++f}if(f===t||p===d-1){var g=u.substring(h,p+1);o&&(g=o+g,g.match("]")&&(o="")),h=p+1,f=0;var v=g.match(F);if(v){var y=v[v.length-1];if("]"!==y[y.length-1])o=y.match(L)[1],g+="]";else if(g.match(M)){g.length;g=g.replace(M,""),o=y.match(L)[1]}}a.push(g)}}else a.push("");return a},encode:function(e){return e=e.replace(/&(?!#[0-9]+;|[a-zA-Z]+;)/g,"&amp;"),e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},escape_formatting:function(t){return e.terminal.escape_brackets(e.terminal.encode(t))},format:function(t,n){var r=e.extend({},{linksNoReferrer:!1},n||{});if("string"==typeof t){var i=e.terminal.format_split(t);return t=i&&i.length>1?e.map(i,function(t){return""===t?t:e.terminal.is_formatting(t)?t.replace(S,function(t,n,i,o,a,s,c){if(""===c)return"";c=c.replace(/\\]/g,"]");var l="";-1!==n.indexOf("b")&&(l+="font-weight:bold;");var u=[];-1!==n.indexOf("u")&&u.push("underline"),-1!==n.indexOf("s")&&u.push("line-through"),-1!==n.indexOf("o")&&u.push("overline"),u.length&&(l+="text-decoration:"+u.join(" ")+";"),-1!==n.indexOf("i")&&(l+="font-style:italic;"),e.terminal.valid_color(i)&&(l+="color:"+i+";",-1!==n.indexOf("g")&&(l+="text-shadow:0 0 5px "+i+";")),e.terminal.valid_color(o)&&(l+="background-color:"+o);var h;h=""===s?c:s.replace(/&#93;/g,"]");var f;return-1!==n.indexOf("!")?h.match(j)?f='<a href="mailto:'+h+'" ':(f='<a target="_blank" href="'+h+'" ',r.linksNoReferer&&(f+='rel="noreferrer" ')):f="<span ",""!==l&&(f+='style="'+l+'"'),""!==a&&(f+=' class="'+a+'"'),f+=-1!==n.indexOf("!")?">"+c+"</a>":' data-text="'+h.replace('"',"&quote;")+'">'+c+"</span>"}):"<span>"+t+"</span>"}).join(""):"<span>"+t+"</span>",t.replace(/<span><br\/?><\/span>/gi,"<br/>")}return""},escape_brackets:function(e){return e.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")},strip:function(e){return e.replace(S,"$6")},active:function(){return B.front()},parseArguments:function(t){return e.terminal.parse_arguments(t)},splitArguments:function(t){return e.terminal.split_arguments(t)},parseCommand:function(t){return e.terminal.parse_command(t)},splitCommand:function(t){return e.terminal.split_command(t)},parse_arguments:function(t){var n=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;return e.map(t.match(E)||[],function(e){if("'"===e[0]&&"'"===e[e.length-1])return e.replace(/^'|'$/g,"");if('"'===e[0]&&'"'===e[e.length-1])return e=e.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"),e.replace(/\\\\|\\t|\\n/g,function(e){return"t"===e[1]?"	":"n"===e[1]?"\n":"\\"}).replace(/\\x([0-9a-f]+)/gi,function(e,t){return String.fromCharCode(parseInt(t,16))}).replace(/\\0([0-7]+)/g,function(e,t){return String.fromCharCode(parseInt(t,8))});if(e.match(/^\/(\\\/|[^\/])+\/[gimy]*$/)){var t=e.match(/^\/([^\/]+)\/([^\/]*)$/);return new RegExp(t[1],t[2])}return e.match(/^-?[0-9]+$/)?parseInt(e,10):e.match(n)?parseFloat(e):e.replace(/\\ /g," ")})},split_arguments:function(t){return e.map(t.match(E)||[],function(e){return"'"===e[0]&&"'"===e[e.length-1]?e.replace(/^'|'$/g,""):'"'===e[0]&&'"'===e[e.length-1]?e.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"):e.match(/\/.*\/[gimy]*$/)?e:e.replace(/\\ /g," ")})},parse_command:function(t){return m(t,e.terminal.parse_arguments)},split_command:function(t){return m(t,e.terminal.split_arguments)},extended_command:function(e,t){try{Q=!1,e.exec(t,!0).then(function(){Q=!0})}catch(n){}}},e.fn.visible=function(){return this.css("visibility","visible")},e.fn.hidden=function(){return this.css("visibility","hidden")};var R={};e.jrpc=function(t,n,r,i,o){R[t]=R[t]||0;var a=e.json_stringify({jsonrpc:"2.0",method:n,params:r,id:++R[t]});return e.ajax({url:t,data:a,success:function(t,n,r){var a=r.getResponseHeader("Content-Type");if(!a.match(/application\/json/)){var s="Response Content-Type is not application/json";if(!console||!console.warn)throw new Error("WARN: "+s);console.warn(s)}var c;try{c=e.parseJSON(t)}catch(l){if(!o)throw new Error("Invalid JSON");return void o(r,"Invalid JSON",l)}i(c,n,r)},error:o,contentType:"application/json",dataType:"text",async:!0,cache:!1,type:"POST"})};var D=!e.terminal.version.match(/^\{\{/),N="Copyright (c) 2011-2015 Jakub Jankiewicz <http://jcubic.pl>",O=D?" v. "+e.terminal.version:" ",K=new RegExp(" {"+O.length+"}$"),W="jQuery Terminal Emulator"+(D?O:""),Y=[["jQuery Terminal","(c) 2011-2015 jcubic"],[W,N.replace(/^Copyright | *<.*>/g,"")],[W,N.replace(/^Copyright /,"")],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(K," ")+O,N],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(K,"")+O,N]];e.terminal.defaults={prompt:"> ",history:!0,exit:!0,clear:!0,enabled:!0,historySize:60,maskChar:"*",checkArity:!0,raw:!1,exceptionHandler:null,cancelableAjax:!0,globalToken:!1,processArguments:!0,linksNoReferrer:!1,processRPCResponse:null,Token:!0,convertLinks:!0,historyState:!1,login:null,outputLimit:-1,formatters:[],onAjaxError:null,onRPCError:null,completion:!1,historyFilter:null,onInit:e.noop,onClear:e.noop,onBlur:e.noop,onFocus:e.noop,onTerminalChange:e.noop,onExit:e.noop,keypress:e.noop,keydown:e.noop,strings:{wrongPasswordTryAgain:"Wrong password try again!",wrongPassword:"Wrong password!",ajaxAbortError:"Error while aborting ajax call!",wrongArity:"Wrong number of arguments. Function '%s' expects %s got %s!",commandNotFound:"Command '%s' Not Found!",oneRPCWithIgnore:"You can use only one rpc with ignoreSystemDescribe",oneInterpreterFunction:"You can't use more than one function (rpcwith ignoreSystemDescribe counts as one)",loginFunctionMissing:"You didn't specify a login function",noTokenError:"Access denied (no token)",serverResponse:"Server responded",wrongGreetings:"Wrong value of greetings parameter",notWhileLogin:"You can't call `%s' function while in login",loginIsNotAFunction:"Authenticate must be a function",canExitError:"You can't exit from main interpreter",invalidCompletion:"Invalid completion",hashChangeMissing:"You need to include hashchange jquery plugin for history to work",invalidSelector:'Sorry, but terminal said that "%s" is not valid selector!',invalidTerminalId:"Invalid Terminal ID",login:"login",password:"password",recursiveCall:"Recursive call detected, skip"}};var q,H=[],B=new l,X=[],Q=!1,U=!0,G=!0;e.fn.terminal=function(n,r){function i(t){return e.isFunction(we.processArguments)?m(t,we.processArguments):we.processArguments?e.terminal.parse_command(t):e.terminal.split_command(t)}function o(t){ie.echo("string"==typeof t?t:t instanceof Array?e.map(t,function(t){return e.json_stringify(t)}).join(" "):"object"==typeof t?e.json_stringify(t):t)}function a(t){var n=/(.*):([0-9]+):([0-9]+)$/,r=t.match(n);r&&(ie.pause(),e.get(r[1],function(t){var n=location.href.replace(/[^\/]+$/,""),i=r[1].replace(n,"");ie.echo("[[b;white;]"+i+"]");
var o=t.split("\n"),a=+r[2]-1;ie.echo(o.slice(a-2,a+3).map(function(t,n){return 2==n&&(t="[[;#f00;]"+e.terminal.escape_brackets(t)+"]"),"["+(a+n)+"]: "+t}).join("\n")).resume()},"text"))}function s(t){e.isFunction(we.onRPCError)?we.onRPCError.call(ie,t):ie.error("&#91;RPC&#93; "+t.message)}function c(t){var n=function(n,r){ie.pause(),e.jrpc(t,n,r,function(t){t.error?s(t.error):e.isFunction(we.processRPCResponse)?we.processRPCResponse.call(ie,t.result):o(t.result),ie.resume()},h)};return function(e,t){if(""!==e){try{e=i(e)}catch(r){return void t.error(r.toString())}if(we.login&&"help"!==e.name){var o=t.token();o?n(e.name,[o].concat(e.args)):t.error("&#91;AUTH&#93; "+_e.noTokenError)}else n(e.name,e.args)}}}function l(n,r,o,a){return function(s,c){if(""!==s){var u;try{u=i(s)}catch(h){return void ie.error(h.toString())}if(o){var f=ie.token(!0);if(!f)return void c.error("&#91;AUTH&#93; "+_e.noTokenError);u.args=[f].concat(u.args)}var p=n[u.name],d=e.type(p);if("function"===d){if(!r||p.length===u.args.length)return p.apply(ie,u.args);ie.error("&#91;Arity&#93; "+sprintf(_e.wrongArity,u.name,p.length,u.args.length))}else if("object"===d||"string"===d){var m=[];"object"===d&&(m=Object.keys(p),p=l(p,we.arity,o)),c.push(p,{prompt:u.name+"> ",name:u.name,completion:"object"===d?m:t})}else e.isFunction(a)?a(s,ie):e.isFunction(we.onCommandNotFound)?we.onCommandNotFound(s,ie):c.error(sprintf(_e.commandNotFound,u.name))}}}function h(t,n,r){ie.resume(),e.isFunction(we.onAjaxError)?we.onAjaxError.call(ie,t,n,r):"abort"!==n&&ie.error("&#91;AJAX&#93; "+n+" - "+_e.serverResponse+": \n"+e.terminal.escape_brackets(t.responseText))}function f(t,n){e.jrpc(t,"system.describe",[],function(r){if(r.procs){var i={};e.each(r.procs,function(n,r){i[r.name]=function(){var n=Se&&"help"!=r.name,i=Array.prototype.slice.call(arguments),a=i.length+(n?1:0);we.checkArity&&r.params&&r.params.length!==a?ie.error("&#91;Arity&#93; "+sprintf(_e.wrongArity,r.name,r.params.length,a)):(ie.pause(),n&&(i=[ie.token(!0)].concat(i)),e.jrpc(t,r.name,i,function(e){e.error?s(e.error):o(e.result),ie.resume()},h))}}),n(i)}else n(null)},function(){n(null)})}function p(t,n,r){r=r||e.noop;var i,o,a=e.type(t),s={},u=0;if("array"===a){var h={};!function p(t,n){if(t.length){var r=t[0],i=t.slice(1),a=e.type(r);"string"===a?(u++,ie.pause(),we.ignoreSystemDescribe?(1===u?o=c(r):ie.error(_e.oneRPCWithIgnore),p(i,n)):f(r,function(t){t&&e.extend(h,t),ie.resume(),p(i,n)})):"function"===a?o?ie.error(_e.oneInterpreterFunction):o=r:"object"===a&&(e.extend(h,r),p(i,n))}else n()}(t,function(){r({interpreter:l(h,!1,n,o),completion:Object.keys(h)})})}else if("string"===a)we.ignoreSystemDescribe?r({interpreter:c(t),completion:we.completion}):(ie.pause(),f(t,function(e){e?(s.interpreter=l(e,!1,n),s.completion=i):(s.interpreter=c(t),s.completion=we.completion),ie.resume(),r(s)}));else if("object"===a)r({interpreter:l(t,we.checkArity),completion:Object.keys(t)});else{if("undefined"===a)t=e.noop;else if("function"!==a)throw a+" is invalid interpreter value";r({interpreter:t,completion:we.completion})}}function v(t,n){var r="boolean"===e.type(n)?"login":n;return function(n,i,o,a){ie.pause(),e.jrpc(t,r,[n,i],function(e){ie.resume(),o(!e.error&&e.result?e.result:null)},h)}}function x(e){return"string"==typeof e?e:"string"==typeof e.fileName?e.fileName+": "+e.message:e.message}function $(t,n){e.isFunction(we.exceptionHandler)?we.exceptionHandler.call(ie,t):ie.exception(t,n)}function T(){var e;e=oe.prop?oe.prop("scrollHeight"):oe.attr("scrollHeight"),oe.scrollTop(e)}function C(t,n){try{if(e.isFunction(n))n(function(){});else if("string"!=typeof n){var r=t+" must be string or function";throw r}}catch(i){return $(i,t.toUpperCase()),!1}return!0}function S(t,n){we.convertLinks&&(t=t.replace(j,"[[!;;]$1]").replace(A,"[[!;;]$1]"));var r,i,o=e.terminal.defaults.formatters;if(!n.raw){for(r=0;r<o.length;++r)try{if("function"==typeof o[r]){var a=o[r](t);"string"==typeof a&&(t=a)}}catch(s){alert("formatting error at formatters["+r+"]\n"+(s.stack?s.stack:s))}t=e.terminal.encode(t)}if(te.push(ne),!n.raw&&(t.length>ce||t.match(/\n/))){var c=n.keepWords,l=e.terminal.split_equal(t,ce,c);for(r=0,i=l.length;i>r;++r)te.push(""===l[r]||"\r"===l[r]?"<span></span>":n.raw?l[r]:e.terminal.format(l[r],{linksNoReferer:we.linksNoReferer}))}else n.raw||(t=e.terminal.format(t,{linksNoReferer:we.linksNoReferer})),te.push(t);te.push(n.finalize)}function F(t,n){try{var r=e.extend({exec:!0,raw:!1,finalize:e.noop},n||{}),i="function"===e.type(t)?t():t;i="string"===e.type(i)?i:String(i),""!==i&&(r.exec?(i=e.map(i.split(z),function(t){return t.match(z)?(t=t.replace(/^\[\[|\]\]$/g,""),ae&&ae.command==t?ie.error(_e.recursiveCall):e.terminal.extended_command(ie,t),""):t}).join(""),""!==i&&S(i,r)):S(i,r))}catch(o){te=[],alert("[Internal Exception(process_line)]:"+x(o)+"\n"+o.stack)}}function P(){Pe.resize(ce);var t,n=se.empty().detach();if(we.outputLimit>=0){var r=0===we.outputLimit?ie.rows():we.outputLimit;t=de.slice(de.length-r-1)}else t=de;try{te=[],e.each(t,function(e,t){F.apply(null,t)}),Pe.before(n),ie.flush()}catch(i){alert("Exception in redraw\n"+i.stack)}}function I(){if(we.greetings===t)ie.echo(ie.signature);else if(we.greetings){var e=typeof we.greetings;"string"===e?ie.echo(we.greetings):"function"===e?we.greetings.call(ie,ie.echo):ie.error(_e.wrongGreetings)}}function E(t){var n=Pe.prompt(),r=Pe.mask();switch(typeof r){case"string":t=t.replace(/./g,r);break;case"boolean":t=r?t.replace(/./g,we.maskChar):e.terminal.escape_formatting(t)}var i={finalize:function(e){e.addClass("command")}};e.isFunction(n)?n(function(e){ie.echo(e+t,i)}):ie.echo(n+t,i)}function L(e){var t=B.get()[e[0]];if(!t)throw new Error(_e.invalidTerminalId);X[e[1]]?t.import_view(X[e[1]]):(Q=!1,e[2]&&t.exec(e[2]).then(function(){Q=!0}))}function M(){Q&&(U=!1,location.hash=e.json_stringify(q),setTimeout(function(){U=!0},100))}function R(){try{if(X.length){var t,n;null===history.state?(t=X[0],n=B.get()[0]):(t=X[history.state.pos],n=B.get()[history.state.id]),n.import_view(t.view),t.join.length&&e.each(t.join,function(e,t){var n=B.get()[t.id];n.import_view(t.view)})}}catch(r){$(r,"TERMINAL")}}function D(n,r,i){function a(){i||(Q=!0,we.historyState&&ie.save_state(n,!1),Q=c),l.resolve(),e.isFunction(we.onAfterCommand)&&we.onAfterCommand(ie,n)}re&&(re=!1,we.historyState&&(X.length?ie.save_state(null):ie.save_state()));try{if(e.isFunction(we.onBeforeCommand)&&we.onBeforeCommand(ie,n)===!1)return;i||(ae=e.terminal.split_command(n)),V()||(i&&e.isFunction(we.historyFilter)&&we.historyFilter(n)||!we.historyFilter)&&Pe.history().append(n);var s=Fe.top();r||E(n);var c=Q;if(n.match(/^\s*login\s*$/i)&&we.login&&1==Fe.size())ie.logout();else{if(!n.match(/^\s*(exit|clear)\s*$/i)||ge){var l=new e.Deferred,u=de.length-1,h=s.interpreter.call(ie,n,ie);return h!==t?(ie.pause(),e.when(h).then(function(e){e&&u===de.length-1&&o(e),a(),ie.resume()})):(xe?ie.bind("resume.command",function(){a(),ie.unbind("resume.command")}):a(),l.promise())}if(we.exit&&n.match(/^\s*exit\s*$/i)){var f=Fe.size();(1==f&&ie.token()||f>1)&&ie.pop()}else we.clear&&n.match(/^\s*clear\s*$/i)&&ie.clear();e.isFunction(we.onAfterCommand)&&we.onAfterCommand(ie,n)}}catch(p){throw $(p,"USER"),ie.resume(),p}}function N(){if(e.isFunction(we.onBeforeLogout))try{if(we.onBeforeLogout(ie)===!1)return}catch(t){throw $(t,"onBeforeLogout"),t}if(O(),e.isFunction(we.onAfterLogout))try{we.onAfterLogout(ie)}catch(t){throw $(t,"onAfterlogout"),t}ie.login(we.login,!0,J)}function O(){var t=ie.prefix_name(!0)+"_";e.Storage.remove(t+"token"),e.Storage.remove(t+"login")}function K(t){var n=ie.prefix_name()+"_interpreters",r=e.Storage.get(n);r=r?e.parseJSON(r):[],-1==e.inArray(t,r)&&(r.push(t),e.Storage.set(n,e.json_stringify(r)))}function W(t){var n=Fe.top(),r=ie.prefix_name(!0);V()||K(r),Pe.name(r),Pe.prompt(e.isFunction(n.prompt)?function(e){n.prompt(e,ie)}:n.prompt),Pe.set(""),!t&&e.isFunction(n.onStart)&&n.onStart(ie)}function J(){W(),I();var t=!1;if(e.isFunction(we.onInit)){ve=function(){t=!0};try{we.onInit(ie)}catch(n){$(n,"OnInit")}finally{ve=e.noop,t||ie.resume()}}G&&we.historyState&&(G=!1,e.fn.hashchange?e(window).hashchange(function(){if(U)try{if(location.hash){var t=location.hash.replace(/^#/,"");q=e.parseJSON(t)}else q=[];q.length?L(q[q.length-1]):X[0]&&ie.import_view(X[0])}catch(n){$(n,"TERMINAL")}}):ie.error(_e.hashChangeMissing))}function Z(t,n,r){we.clear&&r.push("clear"),we.exit&&r.push("exit");var i=Pe.get().substring(0,Pe.position());if(i===t){for(var o=new RegExp("^"+e.terminal.escape_regex(n)),a=[],s=r.length;s--;)o.test(r[s])&&a.push(r[s]);if(1===a.length)ie.insert(a[0].replace(o,""));else if(a.length>1)if(pe>=2)E(t),ie.echo(a.join("	")),pe=0;else{var c,l=!1;e:for(c=n.length;c<a[0].length;++c){for(s=1;s<a.length;++s)if(a[0].charAt(c)!==a[s].charAt(c))break e;l=!0}l&&ie.insert(a[0].slice(0,c).replace(o,""))}}}function V(){return ge||Pe.mask()!==!1}function ee(n){var r,i,o=Fe.top();if(!ie.paused()&&ie.enabled()){if(e.isFunction(o.keydown)&&(r=o.keydown(n,ie),r!==t))return r;var a;if(a=we.completion&&"boolean"!=e.type(we.completion)&&!o.completion?we.completion:o.completion,e.isFunction(we.keydown)&&(r=we.keydown(n,ie),r!==t))return r;if(ie.oneTime(10,function(){ke()}),9!==n.which&&(pe=0),68===n.which&&n.ctrlKey)return ge||(""===Pe.get()?Fe.size()>1||we.login!==t?ie.pop(""):(ie.resume(),ie.echo("")):ie.set_command("")),!1;if(76===n.which&&n.ctrlKey)ie.clear();else{if(a&&9===n.which){++pe;var s,c=Pe.position(),l=Pe.get().substring(0,c),u=l.split(" ");if(1==u.length)s=u[0];else for(s=u[u.length-1],i=u.length-1;i>0&&"\\"==u[i-1][u[i-1].length-1];i--)s=u[i-1]+" "+s;switch(e.type(a)){case"function":a(ie,s,function(e){Z(l,s,e)});break;case"array":Z(l,s,a);break;default:throw new Error(u.invalidCompletion)}return!1}if(86===n.which&&n.ctrlKey)return void ie.oneTime(1,function(){T()});if(9===n.which&&n.ctrlKey){if(B.length()>1)return ie.focus(!1),!1}else 34===n.which?ie.scroll(ie.height()):33===n.which?ie.scroll(-ie.height()):ie.attr({scrollTop:ie.attr("scrollHeight")})}}else if(68===n.which&&n.ctrlKey){if(H.length){for(i=H.length;i--;){var h=H[i];if(4!==h.readyState)try{h.abort()}catch(f){ie.error(u.ajaxAbortError)}}H=[],ie.resume()}return!1}}var te=[],ne=1,re=!0,ie=this;if(this.length>1)return this.each(function(){e.fn.terminal.call(e(this),n,e.extend({name:ie.selector},r))});if(ie.data("terminal"))return ie.data("terminal");if(0===ie.length)throw sprintf(e.terminal.defaults.strings.invalidSelector,ie.selector);var oe,ae,se,ce,le,ue,he,fe,pe=0,de=[],me=B.length(),ge=!1,ve=e.noop,ye=[],we=e.extend({},e.terminal.defaults,{name:ie.selector},r||{}),_e=e.terminal.defaults.strings,be=we.enabled,xe=!1;e.extend(ie,e.omap({id:function(){return me},clear:function(){se.html(""),Pe.set(""),de=[];try{we.onClear(ie)}catch(e){throw $(e,"onClear"),e}return ie.attr({scrollTop:0}),ie},export_view:function(){return{focus:be,mask:Pe.mask(),prompt:ie.get_prompt(),command:ie.get_command(),position:Pe.position(),lines:k(de),interpreters:Fe.clone()}},import_view:function(e){if(ge)throw new Error(sprintf(_e.notWhileLogin,"import_view"));return ie.set_prompt(e.prompt),ie.set_command(e.command),Pe.position(e.position),Pe.mask(e.mask),e.focus&&ie.focus(),de=k(e.lines),Fe=e.interpreters,P(),ie},save_state:function(n,r){if(X.push(ie.export_view()),e.isArray(q)||(q=[]),n!==t){var i=[me,X.length-1,n];q.push(i),r||M()}},exec:function(t,n,r){var i;if(e.isArray(t))return e.when.apply(e,e.map(t,function(e){return ie.exec(e,n)}));if(!xe){var o=D(t,n,!0).then(function(){r&&r.resolve(ie,1)});return r?r.promise():o}return i=r||new e.Deferred,ye.push([t,n,i]),i?i.promise():void 0},autologin:function(e,t,n){return ie.trigger("terminal.autologin",[e,t,n]),ie},login:function(t,n,r,i){function o(t,o,a,s){if(o){for(;Fe.size()>1;)ie.pop();we.history&&Pe.history().enable();var c=ie.prefix_name(!0)+"_";e.Storage.set(c+"token",o),e.Storage.set(c+"login",t),ge=!1,e.isFunction(r)&&r()}else n?(a||ie.error(_e.wrongPasswordTryAgain),ie.pop().set_mask(!1)):(ge=!1,a||ie.error(_e.wrongPassword),ie.pop().pop()),e.isFunction(i)&&i();ie.off("terminal.autologin")}if(ge)throw new Error(sprintf(_e.notWhileLogin,"login"));if(!e.isFunction(t))throw new Error(_e.loginIsNotAFunction);if(ie.token(!0)&&ie.login_name(!0))return e.isFunction(r)&&r(),ie;return we.history&&Pe.history().disable(),ge=!0,ie.on("terminal.autologin",function(e,t,n,r){o(t,n,r)}),ie.push(function(e){ie.set_mask(we.maskChar).push(function(n){try{t.call(ie,e,n,function(t,n){o(e,t,n)})}catch(r){$(r,"USER(authentication)")}},{prompt:_e.password+": "})},{prompt:_e.login+": "})},settings:function(){return we},commands:function(){return Fe.top().interpreter},setInterpreter:function(t,n){function r(){ie.pause(),p(t,function(t){ie.resume();var n=Fe.top();e.extend(n,t),W(!0)})}"string"==e.type(t)&&n?ie.login(v(t,n),!0,r):r()},greetings:function(){return I(),ie},paused:function(){return xe},pause:function(){return ve(),!xe&&Pe&&(xe=!0,ie.disable(),Pe.hidden(),e.isFunction(we.onPause)&&we.onPause()),ie},resume:function(){if(xe&&Pe){xe=!1,ie.enable(),Pe.visible();var t=ye;for(ye=[];t.length;)ie.exec.apply(ie,t.shift());ie.trigger("resume"),T(),e.isFunction(we.onResume)&&we.onResume()}return ie},cols:function(){return ce},rows:function(){return le},history:function(){return Pe.history()},history_state:function(e){return e?ie.oneTime(1,function(){we.historyState=!0}):we.historyState=!1,ie},next:function(){if(1===B.length())return ie;var t=ie.offset().top;ie.height(),ie.scrollTop();if(g(ie)){B.front().disable();var n=B.rotate().enable(),r=n.offset().top-50;e("html,body").animate({scrollTop:r},500);try{we.onTerminalChange(n)}catch(i){throw $(i,"onTerminalChange"),i}return n}return ie.enable(),e("html,body").animate({scrollTop:t-50},500),ie},focus:function(e,t){if(1===B.length())if(e===!1)try{(!t&&we.onBlur(ie)!==!1||t)&&ie.disable()}catch(n){throw $(n,"onBlur"),n}else try{(!t&&we.onFocus(ie)!==!1||t)&&ie.enable()}catch(n){throw $(n,"onFocus"),n}else if(e===!1)ie.next();else{var r=B.front();if(r!=ie&&(r.disable(),!t))try{we.onTerminalChange(ie)}catch(n){throw $(n,"onTerminalChange"),n}B.set(ie),ie.enable()}return ie.oneTime(1,function(){}),ie},freeze:function(e){e?(ie.disable(),fe=!0):(fe=!1,ie.enable())},frozen:function(){return fe},enable:function(){return be||fe||(ce===t&&ie.resize(),Pe&&(Pe.enable(),be=!0)),ie},disable:function(){return be&&Pe&&!fe&&(be=!1,Pe.disable()),ie},enabled:function(){return be},signature:function(){var e=ie.cols(),t=15>e?null:35>e?0:55>e?1:64>e?2:75>e?3:4;return null!==t?Y[t].join("\n")+"\n":""},version:function(){return e.terminal.version},cmd:function(){return Pe},get_command:function(){return Pe.get()},set_command:function(e){return Pe.set(e),ie},insert:function(e){if("string"==typeof e)return Pe.insert(e),ie;throw"insert function argument is not a string"},set_prompt:function(t){return C("prompt",t)&&(Pe.prompt(e.isFunction(t)?function(e){t(e,ie)}:t),Fe.top().prompt=t),ie},get_prompt:function(){return Fe.top().prompt},set_mask:function(e){return Pe.mask(e===!0?we.maskChar:e),ie},get_output:function(t){return t?de:e.map(de,function(t){return e.isFunction(t[0])?t[0]():t[0]}).join("\n")},resize:function(t,n){if(ie.is(":visible")){t&&n&&(ie.width(t),ie.height(n)),t=ie.width(),n=ie.height();var r=y(ie),i=w(ie);(r!==ce||i!==le)&&(ce=r,le=i,P(),e.isFunction(we.onResize)&&we.onResize(ie),he=n,ue=t,T())}else ie.stopTime("resize"),ie.oneTime(500,"resize",function(){ie.resize(t,n)});return ie},flush:function(){try{var t;if(e.each(te,function(n,r){if(r===ne)t=e("<div></div>");else if(e.isFunction(r)){t.appendTo(se);try{r(t)}catch(i){$(i,"USER:echo(finalize)")}}else e("<div/>").html(r).appendTo(t).width("100%")}),we.outputLimit>=0){var n=0===we.outputLimit?ie.rows():we.outputLimit,r=se.find("div div");if(r.length>n){var i=de.length-n+1,o=r.slice(0,i),a=o.parent();o.remove(),a.each(function(){var t=e(this);t.is(":empty")&&t.remove()})}}T(),te=[]}catch(s){alert("[Flush] "+x(s)+"\n"+s.stack)}return ie},update:function(e,t){return 0>e&&(e=de.length+e),de[e]?(de[e][0]=t,P()):ie.error("Invalid line number "+e),ie},echo:function(t,n){return t=t||"",e.when(t).then(function(t){try{te=[];var r=e.extend({flush:!0,raw:we.raw,finalize:e.noop},n||{});F(t,r),de.push([t,e.extend(r,{exec:!1})]),r.flush&&ie.flush(),ke()}catch(i){alert("[Terminal.echo] "+x(i)+"\n"+i.stack)}}),ie},error:function(t,n){var r=e.terminal.escape_brackets(t).replace(/\\$/,"&#92;");return ie.echo("[[;;;error]"+r+"]",n)},exception:function(t,n){var r=x(t);n&&(r="&#91;"+n+"&#93;: "+r),r&&ie.error(r,{finalize:function(e){e.addClass("exception message")}}),"string"==typeof t.fileName&&(ie.pause(),e.get(t.fileName,function(e){ie.resume();var n=t.lineNumber-1,r=e.split("\n")[n];r&&ie.error("["+t.lineNumber+"]: "+r)})),t.stack&&ie.echo(t.stack.split(/\n/g).map(function(e){return"[[;;;error]"+e.replace(A,function(e){return"]"+e+"[[;;;error]"})+"]"}).join("\n"),{finalize:function(e){e.addClass("exception stack-trace")}})},scroll:function(e){var t;return e=Math.round(e),oe.prop?(e>oe.prop("scrollTop")&&e>0&&oe.prop("scrollTop",0),t=oe.prop("scrollTop"),oe.scrollTop(t+e)):(e>oe.attr("scrollTop")&&e>0&&oe.attr("scrollTop",0),t=oe.attr("scrollTop"),oe.scrollTop(t+e)),ie},logout:function(e){if(e)ie.pop();else for(;Fe.size()>0&&!ie.pop(););return ie},token:function(t){return we.globalToken&&(t=!1),e.Storage.get(ie.prefix_name(t)+"_token")},set_token:function(t,n){var r=ie.prefix_name(n)+"_token";return"undefined"==typeof t?e.Storage.remove(r,t):e.Storage.set(r,t),ie},get_token:function(t){return we.globalToken&&(t=!1),e.Storage.get(ie.prefix_name(t)+"_token")},login_name:function(t){return e.Storage.get(ie.prefix_name(t)+"_login")},name:function(){return Fe.top().name},prefix_name:function(e){var t=(we.name?we.name+"_":"")+me;return e&&Fe.size()>1&&(t+="_"+Fe.map(function(e){return e.name}).slice(1).join("_")),t},read:function(t,n){var r=new e.Deferred;return ie.push(function(t){ie.pop(),e.isFunction(n)&&n(t),r.resolve(t)},{prompt:t}),r.promise()},push:function(n,r){r=r||{},!r.name&&ae&&(r.name=ae.name),r.prompt===t&&(r.prompt=r.name+" ");var i=Fe.top();return i&&(i.mask=Pe.mask()),p(n,r.login,function(t){if(Fe.push(e.extend({},t,r)),r.login){var i=e.type(r.login);"function"==i?ie.login(r.login,!1,W,ie.pop):("string"==e.type(n)&&"string"==i||"boolean"==i)&&ie.login(v(n,r.login),!1,W,ie.pop)}else W()}),ie},pop:function(n){n!==t&&E(n);ie.token(!0);if(1==Fe.size()){if(we.login){if(N(),e.isFunction(we.onExit))try{we.onExit(ie)}catch(r){throw $(r,"onExit"),r}return!0}ie.error(_e.canExitError)}else{ie.token(!0)&&O();var i=Fe.pop();if(W(),e.isFunction(i.onExit))try{i.onExit(ie)}catch(r){throw $(r,"onExit"),r}ie.set_mask(Fe.top().mask)}return ie},option:function(t,n){if("undefined"==typeof n){if("string"==typeof t)return we[t];"object"==typeof t&&e.each(t,function(e,t){we[e]=t})}else we[t]=n;return ie},level:function(){return Fe.size()},reset:function(){for(ie.clear();Fe.size()>1;)Fe.pop();return J(),ie},purge:function(){var t=ie.prefix_name()+"_",n=e.Storage.get(t+"interpreters");return e.each(e.parseJSON(n),function(t,n){e.Storage.remove(n+"_commands"),e.Storage.remove(n+"_token"),e.Storage.remove(n+"_login")}),Pe.purge(),e.Storage.remove(t+"interpreters"),ie},destroy:function(){return Pe.destroy().remove(),se.remove(),e(document).unbind(".terminal"),e(window).unbind(".terminal"),ie.unbind("click mousewheel"),ie.removeData("terminal").removeClass("terminal"),we.width&&ie.css("width",""),we.height&&ie.css("height",""),B.remove(me),B.length()||e(window).off("popstate",R),ie}},function(e,t){return function(){try{return t.apply(ie,[].slice.apply(arguments))}catch(n){throw"exec"!==e&&"resume"!==e&&$(n,"TERMINAL"),n}}}));var ke=function(){var e=b(ie);return function(){e!==b(ie)&&(ie.resize(),e=b(ie))}}();we.width&&ie.width(we.width),we.height&&ie.height(we.height);var $e=navigator.userAgent.toLowerCase();if(oe=$e.match(/(webkit)[ \/]([\w.]+)/)||"body"!=ie[0].tagName.toLowerCase()?ie:e("html"),e(document).bind("ajaxSend.terminal",function(e,t,n){H.push(t)}),se=e("<div>").addClass("terminal-output").appendTo(ie),ie.addClass("terminal"),we.login&&e.isFunction(we.onBeforeLogin))try{we.onBeforeLogin(ie)}catch(Te){throw $(Te,"onBeforeLogin"),Te}var Ce,Se=we.login;"string"==typeof n?Ce=n:n instanceof Array&&"string"==typeof n[0]&&(Ce=n[0]),Ce&&("string"==typeof we.login||we.login)&&(we.login=v(Ce,we.login)),B.append(ie);var Fe,Pe;return p(n,we.login,function(n){function r(t){var n=B.get()[t[0]];if(n&&me==n.id()&&t[2])try{return n.exec(t[2]).then(function(e,r){n.save_state(t[2],!0)})}catch(r){var i=e.terminal.escape_brackets(command),o="Error while exec with command "+i;n.error(o).exception(r)}}Fe=new u(e.extend({name:we.name,prompt:we.prompt,keypress:we.keypress,greetings:we.greetings},n)),Pe=e("<div/>").appendTo(ie).cmd({prompt:we.prompt,history:we.history,historyFilter:we.historyFilter,historySize:we.historySize,width:"100%",enabled:be&&!d(),keydown:ee,keypress:function(t){var n=Fe.top();return e.isFunction(n.keypress)?n.keypress(t,ie):void 0},onCommandChange:function(t){if(e.isFunction(we.onCommandChange))try{we.onCommandChange(t,ie)}catch(n){throw $(n,"onCommandChange"),n}T()},commands:D}),be&&ie.is(":visible")&&!d()?ie.focus(t,!0):ie.disable(),ie.oneTime(100,function(){function t(t){var n=e(t.target);!n.closest(".terminal").length&&ie.enabled()&&we.onBlur(ie)!==!1&&ie.disable()}e(document).bind("click.terminal",t).bind("contextmenu.terminal",t)});var i;if(d())ie.find("textarea").blur(function(){be&&ie.focus(!1)});else var o=e(window).focus(function(){i&&ie.focus()}).blur(function(){i=be,ie.disable()});if(ie.click(function(e){ie.enabled()?d()&&ie.focus(!0,!0):ie.focus()}).delegate(".exception a","click",function(t){var n=e(this).attr("href");n.match(/:[0-9]+$/)&&(t.preventDefault(),a(n))}),navigator.platform.match(/linux/i)||ie.mousedown(function(e){if(2==e.which){var t=_();ie.insert(t)}}),ie.is(":visible")&&(ce=y(ie),Pe.resize(ce),le=w(ie)),we.login?ie.login(we.login,!0,J):J(),ie.oneTime(100,function(){o.bind("resize.terminal",function(){if(ie.is(":visible")){var e=ie.width(),t=ie.height();(he!==t||ue!==e)&&ie.resize()}})}),we.execHash)if(location.hash)try{var s=location.hash.replace(/^#/,"");q=e.parseJSON(s),e.when.apply(e,e.map(q,r)).then(function(){Q=!0})}catch(c){}else Q=!0;else Q=!0;if(e.event.special.mousewheel){var l=!1;e(document).bind("keydown.terminal",function(e){e.shiftKey&&(l=!0)}).bind("keyup.terminal",function(e){(e.shiftKey||16==e.which)&&(l=!1)}),ie.mousewheel(function(e,t){l||ie.scroll(t>0?-40:40)})}}),ie.data("terminal",ie),ie}}(jQuery);
